services:
  dev:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: pa-pedia-dev
    volumes:
      # Mount the project directory
      - .:/workspace
      # Persist Go module cache
      - go-mod-cache:/go/pkg/mod
      # Persist npm cache
      - npm-cache:/home/node/.npm
      # Persist node_modules separately to avoid cross-platform issues
      - web-node-modules:/workspace/web/node_modules
    working_dir: /workspace
    # Keep container running
    stdin_open: true
    tty: true
    # Environment variables
    environment:
      - GOPATH=/go
      - NODE_ENV=development
    # Expose ports for development
    ports:
      - "5173:5173"  # Vite dev server
      - "4173:4173"  # Vite preview
    # Run as the node user (from base image, UID/GID 1000)
    user: node

volumes:
  go-mod-cache:
  npm-cache:
  web-node-modules:
